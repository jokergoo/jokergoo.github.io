<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.84.4" />


<title>Textbox annotation - Zuguang Gu</title>
<meta property="og:title" content="Textbox annotation - Zuguang Gu">



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo-text">
A Bioinformagician
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="/post/">Post</a></li>
    
    <li><a href="/software/">Software</a></li>
    
    <li><a href="/publication/">Publication</a></li>
    
    <li><a href="/talks/">Talks</a></li>
    
    <li><a href="https://github.com/jokergoo">GitHub</a></li>
    
    <li><a href="/cv/">CV</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">5 min read</span>
    

    <h1 class="article-title">Textbox annotation</h1>

    
    <span class="article-date">2022-06-15</span>
    

    <div class="article-content">
      
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>In <a href="https://jokergoo.github.io/2020/05/31/word-cloud-as-heatmap-annotation/">a previous post “Word cloud as heatmap
annotation”</a>,
I introduced how to make word clouds and attach them to heatmaps as
annotations. Here I will introduce a more general solution for making
textboxes.</p>
<p>The following new functions are implemented in <strong>ComplexHeatmap</strong> from version
2.13.1. Now you need to update <strong>ComplexHeatmap</strong> from GitHub.</p>
<p>First I will demonstrate a low-level <code>grid.*</code> family function
<code>grid.textbox()</code>. The function simply accepts a vector of texts. If the <code>col</code>
parameter is not specified in <code>gpar()</code>, random colors are used.</p>
<pre class="r"><code>library(ComplexHeatmap)
set.seed(888)
words = sapply(1:30, function(x) strrep(sample(letters, 1), sample(3:10, 1)))
grid.newpage()
grid.textbox(words, gp = gpar(fontsize = runif(30, min = 5, max = 30)))</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-2-1.png" width="432" style="display: block; margin: auto;" /></p>
<p><code>max_width</code> controls the maximal width of the textbox.</p>
<pre class="r"><code>grid.newpage()
grid.textbox(words, gp = gpar(col = &quot;red&quot;, fontsize = 1:30+5), max_width = unit(9, &quot;in&quot;))</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-3-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Set <code>round_corners</code> to <code>TRUE</code>, also set background graphics parameters:</p>
<pre class="r"><code>grid.newpage()
grid.textbox(words, gp = gpar(fontsize = runif(30, min = 5, max = 30)),
    background_gp = gpar(fill = &quot;#FFEEEE&quot;, lty = 2, col = &quot;grey&quot;), round_corners = TRUE,
    padding = unit(c(10, 20, 10, 20), &quot;pt&quot;))</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>One feature of <code>grid.textbox()</code> is it can properly handle long phrases or sentences which are composed
by multiple words. By default, long phrases are treated as single words, which means, if there is no
enough space in a line, the whole phrase is moved to the next line.</p>
<pre class="r"><code>sentenses = c(&quot;This is sentense 1&quot;, &quot;This is a long long long long long long long sentense.&quot;)
grid.newpage()
grid.textbox(sentenses)</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Set <code>word_wrap = TRUE</code> so that long phrases are wrapped if they are too long:</p>
<pre class="r"><code>grid.newpage()
grid.textbox(sentenses, word_wrap = TRUE)</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If <code>add_new_line</code> is set to <code>TRUE</code>, each phrase is put in a separated line.</p>
<pre class="r"><code>grid.newpage()
grid.textbox(sentenses, word_wrap = TRUE, add_new_line = TRUE)</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now we can implement the corresponding annotation function for heatmaps. In <strong>ComplexHeatmap</strong>,
there is a new annotation function <code>anno_textbox()</code>. The two major arguments for <code>anno_textbox()</code> are:</p>
<ul>
<li><code>align_to</code>: It controls how the text boxes are aligned to the heatmap rows.
The value can be a categorical vector which have the same length as
heatmap rows, or a list of row indices. It does not necessarily include
all row indices.</li>
<li><code>text</code>: The corresponding texts. The value should be a
list of texts. To control graphics parameters of texts in the boxes, The
value of <code>text</code> can also be set as a list of data frames where the
first column contains the text, from the second column contains graphics
parameters for each text. The column names should be “col”, “fontsize”,
“fontfamily” and “fontface”.</li>
</ul>
<pre class="r"><code>library(circlize)
mat = matrix(rnorm(100*10), nrow = 100)

split = sample(letters[1:10], 100, replace = TRUE)
text = lapply(unique(split), function(x) {
    data.frame(month.name, col = rand_color(12, friendly = TRUE), fontsize = runif(12, 6, 14))
})
names(text) = unique(split)

split</code></pre>
<pre><code>##   [1] &quot;b&quot; &quot;f&quot; &quot;h&quot; &quot;h&quot; &quot;c&quot; &quot;g&quot; &quot;a&quot; &quot;h&quot; &quot;d&quot; &quot;e&quot; &quot;g&quot; &quot;c&quot; &quot;j&quot; &quot;c&quot; &quot;c&quot; &quot;j&quot; &quot;a&quot; &quot;d&quot;
##  [19] &quot;i&quot; &quot;h&quot; &quot;a&quot; &quot;i&quot; &quot;g&quot; &quot;a&quot; &quot;b&quot; &quot;e&quot; &quot;i&quot; &quot;a&quot; &quot;c&quot; &quot;h&quot; &quot;j&quot; &quot;j&quot; &quot;b&quot; &quot;c&quot; &quot;c&quot; &quot;e&quot;
##  [37] &quot;j&quot; &quot;a&quot; &quot;d&quot; &quot;d&quot; &quot;j&quot; &quot;h&quot; &quot;j&quot; &quot;d&quot; &quot;b&quot; &quot;h&quot; &quot;e&quot; &quot;h&quot; &quot;b&quot; &quot;j&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;c&quot;
##  [55] &quot;g&quot; &quot;d&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot; &quot;g&quot; &quot;b&quot; &quot;g&quot; &quot;h&quot; &quot;j&quot; &quot;g&quot; &quot;f&quot; &quot;i&quot; &quot;j&quot; &quot;a&quot; &quot;d&quot; &quot;i&quot; &quot;b&quot;
##  [73] &quot;c&quot; &quot;b&quot; &quot;f&quot; &quot;e&quot; &quot;h&quot; &quot;c&quot; &quot;a&quot; &quot;c&quot; &quot;a&quot; &quot;j&quot; &quot;h&quot; &quot;e&quot; &quot;e&quot; &quot;a&quot; &quot;j&quot; &quot;h&quot; &quot;a&quot; &quot;d&quot;
##  [91] &quot;e&quot; &quot;f&quot; &quot;j&quot; &quot;j&quot; &quot;c&quot; &quot;j&quot; &quot;f&quot; &quot;d&quot; &quot;b&quot; &quot;i&quot;</code></pre>
<pre class="r"><code>text[1:2]</code></pre>
<pre><code>## $b
##    month.name       col  fontsize
## 1     January #0E0768FF  9.891577
## 2    February #0C8B21FF  7.416968
## 3       March #2C038DFF 12.242896
## 4       April #2AA00CFF 10.454699
## 5         May #74A80DFF  9.777079
## 6        June #4C089AFF  9.825270
## 7        July #4C008FFF  6.179774
## 8      August #0B7C04FF  7.696559
## 9   September #3A810BFF 10.993755
## 10    October #360078FF  8.168969
## 11   November #980228FF  9.337481
## 12   December #960C3DFF 10.450466
## 
## $f
##    month.name       col  fontsize
## 1     January #6E0B9BFF  6.639206
## 2    February #042F7DFF 12.770203
## 3       March #099801FF  9.718325
## 4       April #490E90FF  8.623842
## 5         May #092C79FF 12.441386
## 6        June #0A1274FF  9.944144
## 7        July #051B65FF 13.958028
## 8      August #0A0161FF  6.600719
## 9   September #05833AFF  9.839931
## 10    October #4D7704FF 10.190130
## 11   November #5B098FFF  6.375925
## 12   December #007974FF 10.547464</code></pre>
<pre class="r"><code>Heatmap(mat, cluster_rows = FALSE, row_split = split,
    right_annotation = rowAnnotation(wc = anno_textbox(split, text))
)</code></pre>
<p><img src="/post/2022-06-15-textbox-annotation_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.2.0 (2022-04-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur/Monterey 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] C/UTF-8/C/C/C/C
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] circlize_0.4.16       ComplexHeatmap_2.13.1 knitr_1.39           
## [4] colorout_1.2-2       
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.8.3        highr_0.9           bslib_0.3.1        
##  [4] compiler_4.2.0      RColorBrewer_1.1-3  jquerylib_0.1.4    
##  [7] iterators_1.0.14    tools_4.2.0         digest_0.6.29      
## [10] clue_0.3-61         jsonlite_1.8.0      evaluate_0.15      
## [13] png_0.1-7           rlang_1.0.2         foreach_1.5.2      
## [16] cli_3.3.0           magick_2.7.3        yaml_2.3.5         
## [19] parallel_4.2.0      blogdown_0.8        xfun_0.31          
## [22] fastmap_1.1.0       cluster_2.1.3       stringr_1.4.0      
## [25] sass_0.4.1          GlobalOptions_0.1.2 S4Vectors_0.34.0   
## [28] IRanges_2.30.0      stats4_4.2.0        R6_2.5.1           
## [31] GetoptLong_1.0.5    rmarkdown_2.14      bookdown_0.15      
## [34] magrittr_2.0.3      codetools_0.2-18    htmltools_0.5.2    
## [37] matrixStats_0.62.0  BiocGenerics_0.42.0 shape_1.4.6        
## [40] colorspace_2.0-3    stringi_1.7.6       doParallel_1.0.17  
## [43] crayon_1.5.1        rjson_0.2.21</code></pre>

    </div>
  </article>

  
  <script src="https://utteranc.es/client.js"
    repo="jokergoo/jokergoo.github.io"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
  
  
</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

