---
title: "Translate from other heatmap functions to ComplexHeatmap"
date: 2020-12-14
---


```{r, echo = FALSE}
library(knitr)
knitr::opts_chunk$set(
    error = FALSE,
    tidy  = FALSE,
    message = FALSE,
    warning = FALSE,
    fig.align = "center",
    fig.width = 10
)
options(width = 100)
```

In my previous post ["Translate from pheatmap to
ComplexHeatmap"](https://jokergoo.github.io/2020/05/06/translate-from-pheatmap-to-complexheatmap/),
I introduced a `ComplexHeatmap::pheatmap()` which smoothly executes
`pheatmap::pheatmap()` code without any problem. With the newly developed
[**InteractiveComplexHeatmap**
package](https://github.com/jokergoo/InteractiveComplexHeatmap), the output of
`pheatmap()` can be directly exported as an interactive Shiny app.

```r
library(ComplexHeatmap)
ht = pheatmap(...)
library(InteractiveComplexHeatmap)
ht_shiny(ht)
```

To facilitate the users who are still using `heatmap()` and `heatmap.2()`
functions, to make the output of these two functions can be exported as interactive Shiny
apps as well, I implemented two similar translation functions
`ComplexHeatmap::heatmap()` and `ComplexHeatmap::heatmap.2()` which use the
same set of arguments as the original functions and generate almost identical
plots.

Some arguments in the two original functions are ignored in the
**ComplexHeatmap** implementation, but there won't be any error thrown out.

Then with `ComplexHeatmap::heatmap()` and `ComplexHeatmap::heatmap.2()`, you
can make your old heatmaps interactive by:

```r
library(ComplexHeatmap)
ht = heatmap(...) # or ht = heatmap.2(...)
library(InteractiveComplexHeatmap)
ht_shiny(ht)
```

To replace the two original functions with `ComplexHeatmap::heatmap()` and
`ComplexHeatmap::heatmap.2()`, we need to make sure the new homonymous
functions generates the same plots as the old ones. In the following examples,
`compare_heatmap()` basically sends all the arguments to `stats::heatmap()`
and `ComplexHeatmap::heatmap()` separately and you can directly compare the
two plots generated by the two functions.

```{r}
library(ComplexHeatmap)
```

## Translate from `stats::heatmap()`

```{r}
x  = as.matrix(mtcars)
rc = rainbow(nrow(x), start = 0, end = 0.3)
cc = rainbow(ncol(x), start = 0, end = 0.3)
compare_heatmap(x, col = cm.colors(256), scale = "column",
              RowSideColors = rc, ColSideColors = cc, margins = c(5,10),
              xlab = "specification variables", ylab =  "Car Models",
              main = "heatmap(<Mtcars data>, ..., scale = \"column\")")
```

```{r}
compare_heatmap(x, Colv = NA, col = cm.colors(256), scale = "column",
        RowSideColors = rc, margins = c(5,10),
        xlab = "specification variables", ylab =  "Car Models",
        main = "heatmap(<Mtcars data>, ..., scale = \"column\")")
```

```{r}
compare_heatmap(x, Rowv = NA, Colv = NA, scale = "column",
        main = "heatmap(*, NA, NA) ~= image(t(x))")
```

```{r}
Ca = cor(attitude)
cc = rainbow(nrow(Ca))
compare_heatmap(Ca, Rowv = FALSE, RowSideColors = cc, ColSideColors = cc)
```

```{r}
cU = cor(USJudgeRatings)
compare_heatmap(cU, Rowv = FALSE, col = topo.colors(16),
             distfun = function(c) as.dist(1 - c), keep.dendro = TRUE)
```


## Translate from `gplots::heatmap.2()`

Similarly, in the following examples, `compare_heatmap.2()` basically sends
all the arguments to `gplots::heatmap.2()` and `ComplexHeatmap::heatmap.2()`
separately.

```{r}
data(mtcars)
x = as.matrix(mtcars)
rc = rainbow(nrow(x), start = 0, end = .3)
cc = rainbow(ncol(x), start = 0, end = .3)
compare_heatmap.2(x)
```

```{r}
compare_heatmap.2(x, dendrogram = "none")
```

```{r}
compare_heatmap.2(x, dendrogram = "row")
```

```{r}
compare_heatmap.2(x, dendrogram = "col")
```


```{r}
compare_heatmap.2(x, Rowv = FALSE, dendrogram = "both")
```

```{r}
compare_heatmap.2(x, Rowv = NULL, dendrogram = "both")
```

```{r}
compare_heatmap.2(x, Colv = FALSE, dendrogram = "both")
```

```{r}
compare_heatmap.2(x, reorderfun = function(d, w) reorder(d, w, agglo.FUN = mean))
```



```{r}
compare_heatmap.2(x, col = gplots::bluered, scale = "column", tracecol = "#303030")
```

```{r}
compare_heatmap.2(x, col = cm.colors(255), scale = "column",
         RowSideColors = rc, ColSideColors = cc, margin = c(5, 10),
         xlab = "specification variables", ylab = "Car Models",
         main = "heatmap(<Mtcars data>, ..., scale=\"column\")",
         tracecol = "green", density = "density")
```


```{r}
compare_heatmap.2(x, col = cm.colors(255), scale = "column",
         RowSideColors = rc, ColSideColors = cc, margin = c(5, 10),
         xlab = "specification variables", ylab = "Car Models",
         main = "heatmap(<Mtcars data>, ..., scale=\"column\")",
         tracecol = "green", density = "density", colRow = rc, colCol = cc,
         srtCol = 45, adjCol = c(0.5,1))
```

```{r}
data(attitude)
Ca = cor(attitude)

compare_heatmap.2(Ca, symm = TRUE, margin = c(6, 6), trace = "none" )
```


```{r}
compare_heatmap.2(Ca, Rowv = FALSE, symm = TRUE, margin = c(6, 6), trace = "none" )
```


```{r}
data(USJudgeRatings)
cU = cor(USJudgeRatings)

compare_heatmap.2(cU, Rowv = FALSE, symm = TRUE, col = topo.colors(16),
              distfun = function(c) as.dist(1 - c), trace = "none")
```

```{r}
hM = format(round(cU, 2))
compare_heatmap.2(cU, Rowv = FALSE, symm = TRUE, col = rev(heat.colors(16)),
             distfun = function(c) as.dist(1 - c), trace = "none",
             cellnote = hM)
```

```{r}
library(affy)
data(SpikeIn)
pms = SpikeIn@pm

compare_heatmap.2(pms, col = rev(heat.colors(16)), main = "SpikeIn@pm",
              xlab = "Relative Concentration", ylab = "Probeset",
              scale = "row")
```

```{r}
data = pms / pms[, "12.50"]
data = ifelse(data > 1, data, -1 / data)
compare_heatmap.2(data, breaks = 16, col = gplots::redgreen, tracecol = "blue",
               main = "SpikeIn@pm Fold Changes\nrelative to 12.50 sample",
               xlab = "Relative Concentration", ylab = "Probeset")
```

## SessionInfo

```{r}
sessionInfo()
```

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
  $(document).ready(function(){
  $("img").css("display", "inline");
  $("main.content").css("max-width", "1000px");
});
</script>

